{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ lesson.title }} - Language Learning Platform</title>
    {% if IS_DEVEDU %}<base href="/proxy/8000{{ request.path }}{% if not request.path|slice:'-1:' == '/' %}/{% endif %}">{% endif %}
    <link rel="stylesheet" href="{% static 'home/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/components.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/pages.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/animations.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/utilities.css' %}">
    <style>
        .lesson-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .lesson-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .flashcard-carousel {
            position: relative;
            max-width: 600px;
            margin: 2rem auto;
            perspective: 1000px;
        }
        .flashcard {
            width: 100%;
            height: 400px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transform-style: preserve-3d;
        }
        .flashcard-front,
        .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 2rem;
            font-size: 2rem;
            font-weight: 600;
        }
        .flashcard-front {
            background: linear-gradient(135deg, #ffffff, #f0fdfa);
            border: 3px solid #14b8a6;
            color: #0f172a;
        }
        .flashcard-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #fff5f5, #ffe8e8);
            border: 3px solid #ff6b6b;
            color: #0f172a;
        }
        .carousel-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        .carousel-btn {
            padding: 0.75rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        .carousel-btn:hover {
            background: #5568d3;
        }
        .carousel-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .quiz-button {
            display: inline-block;
            margin-top: 2rem;
            padding: 1rem 2rem;
            background: var(--gradient-primary);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .card-counter {
            text-align: center;
            margin-top: 1rem;
            color: #666;
        }
        .pronounce-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: rgba(79, 70, 229, 0.12);
            color: var(--primary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            z-index: 2;
        }
        .pronounce-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.25);
        }
        .flashcard-back .pronounce-btn {
            background: rgba(255, 255, 255, 0.25);
            color: white;
        }
        .flashcard-text {
            display: block;
            text-align: center;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    {% include '_nav.html' %}
    
    <main class="lesson-container">
        <div class="lesson-header">
            <h1>{{ lesson.title }}</h1>
            <p>{{ lesson.description }}</p>
        </div>
        
        {% if cards %}
        <div class="flashcard-carousel">
            {% for card in cards %}
            <div class="flashcard-slide" data-index="{{ forloop.counter0 }}" style="display: {% if forloop.first %}block{% else %}none{% endif %};">
                <div class="flashcard" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <button class="pronounce-btn" type="button" aria-label="Play pronunciation" data-speak-text="{{ card.front_text }}" data-speak-lang="en-US">ðŸ”Š</button>
                            <span class="flashcard-text">{{ card.front_text }}</span>
                        </div>
                        <div class="flashcard-back">
                            <button class="pronounce-btn" type="button" aria-label="Play pronunciation" data-speak-text="{{ card.back_text }}" data-speak-lang="{{ speech_code }}">ðŸ”Š</button>
                            <span class="flashcard-text">{{ card.back_text }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="card-counter">
            <span id="current-card">1</span> / {{ cards|length }}
        </div>
        
        <div class="carousel-controls">
            <button class="carousel-btn" id="prev-btn" disabled>Previous</button>
            <button class="carousel-btn" id="next-btn">Next</button>
        </div>
        {% endif %}
        
        <div style="text-align: center;">
            <a href="{% if IS_DEVEDU %}quiz/{% else %}{% url 'lesson_quiz' lesson.id %}{% endif %}" class="quiz-button">Take Quiz</a>
        </div>
    </main>
    
    <script>
        const slides = document.querySelectorAll('.flashcard-slide');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const counter = document.getElementById('current-card');
        let currentIndex = 0;
        
        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.style.display = i === index ? 'block' : 'none';
                const flashcard = slide.querySelector('.flashcard');
                flashcard.classList.remove('flipped');
            });
            
            counter.textContent = index + 1;
            prevBtn.disabled = index === 0;
            nextBtn.disabled = index === slides.length - 1;
        }
        
        prevBtn.addEventListener('click', () => {
            if (currentIndex > 0) {
                currentIndex--;
                showSlide(currentIndex);
            }
        });
        
        nextBtn.addEventListener('click', () => {
            if (currentIndex < slides.length - 1) {
                currentIndex++;
                showSlide(currentIndex);
            }
        });
    </script>
    {% include 'includes/pronunciation_script.html' with speech_code=speech_code %}
</body>
</html>