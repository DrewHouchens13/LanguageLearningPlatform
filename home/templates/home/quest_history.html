{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest History - Language Learning Platform</title>
    {% if IS_DEVEDU %}<base href="/proxy/8000{{ request.path }}{% if not request.path|slice:'-1:' == '/' %}/{% endif %}">{% endif %}
    <link rel="stylesheet" href="{% static 'home/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/components.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/pages.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/animations.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/utilities.css' %}">
  </head>
  <body>
    {% include '_nav.html' %}

    <main class="container">
      <!-- Django Messages -->
      {% if messages %}
        <div class="mt-xl">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Quest History Header -->
      <section class="fade-in" style="margin-top: var(--space-xl);">
        <div class="text-center mb-lg">
          <h1 class="page-title">Quest History ğŸ“œ</h1>
        </div>

        {% if logs %}
          <!-- Total Stats Card -->
          <div class="card card-bordered fade-in-up mb-lg" style="max-width: 800px; margin-left: auto; margin-right: auto; margin-bottom: var(--space-lg);">
            <div class="card-body text-center">
              <div class="mb-sm">
                <span style="font-size: 3rem;">â­</span>
              </div>
              <h3 class="text-muted" style="font-size: var(--font-size-sm); margin-bottom: var(--space-xs);">Total Quest XP Earned</h3>
              <p style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--color-success);">{{ total_quest_xp }}</p>
              <p class="text-muted" style="font-size: var(--font-size-sm);">{{ logs|length }} challenge{{ logs|length|pluralize }} completed</p>
            </div>
          </div>

          <!-- Quest List -->
          <div class="quest-list" style="max-width: 800px; margin: 0 auto;">
            {% for entry in logs %}
              <div class="card card-bordered fade-in-up mb-md" style="animation-delay: {{ forloop.counter0|add:1|stringformat:'d' }}00ms;">
                <div class="card-body">
                  <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-sm);">
                    <div>
                      <h3 class="card-title" style="margin-bottom: var(--space-xs);">
                        {% if entry.completed_via == 'onboarding' %}ğŸš€ Onboarded{% else %}ğŸ“˜ Lesson{% endif %} Â· {{ entry.language|default:"Any" }}
                      </h3>
                      <p class="text-muted" style="font-size: var(--font-size-sm);">
                        ğŸ“… {{ entry.date|date:"F j, Y" }}
                      </p>
                    </div>
                    <span class="badge" style="background: var(--color-success); color: white; padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-sm); font-size: var(--font-size-sm);">
                      +{{ entry.xp_awarded }} XP
                    </span>
                  </div>
                  
                  <div style="display: flex; flex-wrap: wrap; gap: var(--space-xl); margin-top: var(--space-md); padding-top: var(--space-md); border-top: 1px solid var(--color-border);">
                    <div>
                      <p class="text-muted" style="font-size: var(--font-size-sm); margin-bottom: var(--space-xs);">Completed Via</p>
                      <p style="font-weight: 600; text-transform: capitalize;">{{ entry.completed_via }}</p>
                    </div>
                    <div>
                      <p class="text-muted" style="font-size: var(--font-size-sm); margin-bottom: var(--space-xs);">Language</p>
                      <p style="font-weight: 600;">{{ entry.language|default:"Mixed" }}</p>
                    </div>
                    <div>
                      <p class="text-muted" style="font-size: var(--font-size-sm); margin-bottom: var(--space-xs);">Logged At</p>
                      <p style="font-weight: 600;">{{ entry.created_at|date:"M j, g:i A" }}</p>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <!-- Empty State -->
          <div class="card card-bordered fade-in-up" style="max-width: 600px; margin: 0 auto;">
            <div class="card-body text-center">
              <div class="mb-md">
                <span style="font-size: 4rem;">ğŸ¯</span>
              </div>
              <h2 class="card-title mb-sm">No Quests Completed Yet</h2>
              <p class="text-muted mb-lg">Start your first daily quest to earn XP and track your progress!</p>
              <a href="{% if IS_DEVEDU %}../../quests/daily/{% else %}{% url 'daily_quest' %}{% endif %}" class="btn btn-primary">
                Open Daily Challenge
              </a>
            </div>
          </div>
        {% endif %}
      </section>
    </main>

    <footer class="footer">
      <div class="container">
        <p class="text-center text-muted">&copy; 2025 Language Learning Platform. Start learning today!</p>
      </div>
    </footer>
  </body>
</html>
