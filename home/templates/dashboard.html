{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Language Learning Platform</title>
    {% if IS_DEVEDU %}<base href="/proxy/8000{{ request.path }}{% if not request.path|slice:'-1:' == '/' %}/{% endif %}">{% endif %}
    <link rel="stylesheet" href="{% static 'home/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/components.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/pages.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/animations.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/utilities.css' %}">
  </head>
  <body>
    {% include '_nav.html' %}
    
    <main class="container">
      <!-- Django Messages -->
      {% if messages %}
        <div class="mt-xl">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <!-- Dashboard Header with Streak -->
      <section class="dashboard-header fade-in">
        <div class="dashboard-welcome">
          <div style="flex: 1;">
            <h2 class="dashboard-title">Welcome back, {{ user.first_name }}! üëã</h2>
            <p class="dashboard-subtitle">
              {% if current_streak > 0 %}
                Keep your streak alive! You're doing great!
              {% else %}
                Ready to start your learning journey?
              {% endif %}
            </p>

            <!-- Compact XP Display -->
            {% if user_profile %}
            <div style="display: flex; gap: var(--space-md); margin-top: var(--space-md); flex-wrap: wrap;">
              <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: var(--space-sm) var(--space-md); border-radius: var(--radius-lg); color: white; display: flex; align-items: center; gap: var(--space-sm);">
                <span style="font-size: 1.5rem;">‚ö°</span>
                <div>
                  <div style="font-size: var(--text-sm); opacity: 0.9;">Level {{ user_profile.current_level }}</div>
                  <div style="font-weight: 700; font-size: var(--text-lg);">{{ user_profile.total_xp|floatformat:0 }} XP</div>
                </div>
              </div>
              <div style="flex: 1; min-width: 200px;">
                <div style="font-size: var(--text-xs); margin-bottom: var(--space-xs); color: var(--text-secondary);">
                  Progress to Level {{ user_profile.current_level|add:1 }} ({{ xp_progress_percent|floatformat:0 }}%)
                </div>
                <div style="width: 100%; height: 12px; background: var(--gray-200); border-radius: var(--radius-full); overflow: hidden;">
                  <div style="height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: {{ xp_progress_percent }}%; transition: width 0.5s ease;"></div>
                </div>
                <div style="font-size: var(--text-xs); margin-top: var(--space-xs); color: var(--text-secondary);">
                  {{ xp_to_next_level }} XP to next level
                </div>
              </div>
            </div>
            {% endif %}
          </div>

          <!-- Animated Streak Fire -->
          <div class="streak-fire-container">
            <div class="fire-glow {% if current_streak > 0 %}active{% endif %}"></div>
            <div class="fire-emoji {% if current_streak > 0 %}active{% else %}dead{% endif %}">üî•</div>
            <div class="streak-stats">
              <span class="streak-number">{{ current_streak }}</span>
              <span class="streak-label">Day Streak</span>
            </div>
          </div>

          <div style="text-align: center;">
            {% if user.profile %}
              <img src="{{ user.profile.get_avatar_url }}" alt="{{ user.username }}'s avatar" class="avatar avatar-2xl" style="margin-bottom: var(--space-sm);">
            {% else %}
              <img src="https://www.gravatar.com/avatar/?s=200&d=identicon" alt="{{ user.username }}'s avatar" class="avatar avatar-2xl" style="margin-bottom: var(--space-sm);">
            {% endif %}
            {% if user_profile and user_profile.has_completed_onboarding %}
              <div>
                <span class="badge badge-primary" style="font-size: var(--font-size-sm); padding: var(--space-xs) var(--space-md);">
                  {{ user_profile.get_proficiency_level_display }}
                </span>
              </div>
            {% endif %}
          </div>
        </div>
      </section>
      
      <!-- Placement Test CTA (Dynamic for Multiple Languages) -->
      {% if pending_languages %}
        <section class="card card-bordered fade-in-up delay-100" style="background: linear-gradient(135deg, #fff3cd 0%, #fef3c7 100%);">
          <div class="card-body text-center">
            <h3 class="text-3xl font-bold mb-md" style="color: #92400e;">üìù Discover Your Language Proficiency</h3>
            <p class="text-lg mb-md" style="color: #92400e;">Take a quick placement test to unlock personalized lessons!</p>

            {% if pending_languages|length == 1 %}
              <!-- Single language available -->
              <p class="mb-xl" style="color: #78350f; font-weight: 600;">Available: {{ pending_languages.0 }}</p>
              <a href="{% url 'onboarding_welcome' %}?language={{ pending_languages.0 }}" class="btn btn-accent btn-lg">
                Start {{ pending_languages.0 }} Test ‚Üí
              </a>
            {% else %}
              <!-- Multiple languages available -->
              <p class="mb-lg" style="color: #78350f;">Choose a language to test:</p>
              <div style="display: flex; flex-wrap: wrap; gap: var(--space-md); justify-content: center;">
                {% for language in pending_languages %}
                  <a href="{% url 'onboarding_welcome' %}?language={{ language }}" class="btn btn-accent">
                    {{ language }}
                  </a>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </section>
      {% endif %}

      <!-- Daily Challenge Card -->
      {% if daily_quest %}
        <section class="card card-bordered fade-in-up delay-150" style="margin-top: var(--space-3xl); margin-bottom: var(--space-2xl); background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 2px solid #0ea5e9;">
          <div class="card-body">
            <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: var(--space-md);">
              <div style="flex: 1; min-width: 250px;">
                <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-xs);">
                  <span style="font-size: 2rem;">üéØ</span>
                  <h3 class="card-title" style="margin: 0;">Daily Challenge</h3>
                </div>
                <p class="text-muted" style="margin-bottom: var(--space-md);">{{ daily_quest.date|date:"F j, Y" }}</p>

                {% if quest_complete %}
                  <div style="display: flex; align-items: center; gap: var(--space-sm); padding: var(--space-md); background: var(--color-success-light, #d1fae5); border-radius: var(--radius-md); margin-bottom: var(--space-md);">
                    <span style="font-size: 1.5rem;">‚úÖ</span>
                    <div>
                      <p style="font-weight: 600; color: var(--color-success); margin: 0;">Challenge Completed!</p>
                      <p class="text-muted" style="font-size: var(--font-size-sm); margin: 0;">Come back tomorrow for a new challenge</p>
                    </div>
                  </div>
                {% else %}
                  <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--space-md); background: var(--color-surface); border-radius: var(--radius-md); margin-bottom: var(--space-md);">
                    <div>
                      <p style="font-weight: 600; margin-bottom: var(--space-xs);">üìö {{ daily_quest.title }}</p>
                      <p class="text-muted" style="font-size: var(--font-size-sm); margin: 0;">{{ daily_quest.description }}</p>
                    </div>
                  </div>

                  <div style="display: flex; align-items: center; gap: var(--space-xs);">
                    <span>‚≠ê</span>
                    <span style="font-weight: 600; color: var(--color-success);">{{ daily_quest.xp_reward }} XP available</span>
                  </div>
                {% endif %}
              </div>

              <div style="display: flex; align-items: center;">
                {% if quest_complete %}
                  <a href="{% url 'quest_history' %}" class="btn btn-outline">
                    View History
                  </a>
                {% else %}
                  <a href="{% url 'daily_quest' %}" class="btn btn-primary btn-lg">
                    Start Challenge ‚Üí
                  </a>
                {% endif %}
              </div>
            </div>
          </div>
        </section>
      {% endif %}
      
      <!-- Quick Actions -->
      <section class="mt-3xl">
        <h3 class="text-3xl font-bold mb-xl text-center">Quick Actions</h3>
        <div class="features-grid">
          <a href="{% url 'lessons_list' %}" class="feature-item hover-lift" style="text-decoration: none;">
            <div class="feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ff6b6b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
              </svg>
            </div>
            <h3>Browse Lessons</h3>
            <p>Explore our catalog of interactive language lessons designed for your level.</p>
          </a>

          <a href="{% url 'progress' %}" class="feature-item hover-lift" style="text-decoration: none;">
            <div class="feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ff6b6b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="20" x2="18" y2="10"></line>
                <line x1="12" y1="20" x2="12" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="14"></line>
              </svg>
            </div>
            <h3>View Progress</h3>
            <p>Track your learning journey with detailed statistics and achievements.</p>
          </a>

          <a href="{% url 'account' %}" class="feature-item hover-lift" style="text-decoration: none;">
            <div class="feature-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ff6b6b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
                <path d="M19.07 4.93l-4.24 4.24m0 5.66l4.24 4.24M4.93 4.93l4.24 4.24m0 5.66l-4.24 4.24"></path>
              </svg>
            </div>
            <h3>Account Settings</h3>
            <p>Update your profile, change password, and customize your experience.</p>
          </a>
        </div>
      </section>
    </main>
    
    <footer>
      <p>&copy; 2025 Language Learning Platform. Empowering language learners worldwide.</p>
    </footer>

    <script>
      // Mobile menu toggle
      const navToggle = document.querySelector('.nav-toggle');
      const navCenter = document.querySelector('.nav-center');
      
      if (navToggle && navCenter) {
        navToggle.addEventListener('click', () => {
          navCenter.classList.toggle('active');
          navToggle.classList.toggle('active');
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
          if (!navToggle.contains(e.target) && !navCenter.contains(e.target)) {
            navCenter.classList.remove('active');
            navToggle.classList.remove('active');
          }
        });
      }
    </script>
  </body>
</html>