{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Language Learning Platform</title>
    {% if IS_DEVEDU %}<base href="/proxy/8000{{ request.path }}{% if not request.path|slice:'-1:' == '/' %}/{% endif %}">{% endif %}
    <link rel="stylesheet" href="{% static 'home/styles.css' %}">
  </head>
  <body>
    {% include '_nav.html' %}
    
    <main>
      <!-- Django Messages -->
      {% if messages %}
        <div class="page-messages">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <section class="hero">
        <div class="hero-content">
          <h2>Welcome, {{ user.first_name }}! üëã</h2>
          <p>This is your personal dashboard. Here you can track your progress, manage your courses, and continue your language learning journey.</p>
          {% if not has_completed_onboarding %}
            <div style="margin: 1.5rem 0; padding: 1rem; background-color: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">
              <p style="margin: 0 0 0.5rem 0; font-weight: 600; color: #856404;">üìù Take Your Placement Test</p>
              <p style="margin: 0 0 1rem 0; color: #856404;">Discover your Spanish proficiency level to unlock personalized lessons tailored to your skills!</p>
              <a href="{% url 'onboarding_welcome' %}" style="display: inline-block; padding: 0.5rem 1rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">Take Assessment Now</a>
            </div>
          {% else %}
            <p><strong>Your Level:</strong> <span style="display: inline-block; padding: 0.25rem 0.75rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">{{ user_profile.get_proficiency_level_display }}</span></p>
          {% endif %}

          <!-- XP and Leveling System -->
          {% if user.profile %}
          <div style="margin: 1.5rem 0; padding: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <div>
                <h3 style="margin: 0 0 0.5rem 0; font-size: 1.5rem;">Level {{ user.profile.current_level }}</h3>
                <p style="margin: 0; font-size: 1.1rem; opacity: 0.9;">{{ user.profile.total_xp }} XP</p>
              </div>
              <div style="text-align: right;">
                <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Next Level</p>
                <p style="margin: 0; font-size: 1.2rem; font-weight: 600;">{{ user.profile.get_xp_to_next_level }} XP to go</p>
              </div>
            </div>
            <div style="background: rgba(255,255,255,0.3); border-radius: 10px; height: 12px; overflow: hidden;">
              <div style="background: white; height: 100%; width: {{ user.profile.get_progress_to_next_level }}%; transition: width 0.3s ease;"></div>
            </div>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; opacity: 0.9; text-align: center;">{{ user.profile.get_progress_to_next_level|floatformat:0 }}% to Level {{ user.profile.current_level|add:1 }}</p>
          </div>
          {% endif %}

          <p><strong>Email:</strong> {{ user.email }}</p>
          <p><strong>Username:</strong> {{ user.username }}</p>
          <p><strong>Member since:</strong> {{ user.date_joined|date:"F d, Y" }}</p>
        </div>
        <div class="hero-image dashboard-avatar-container">
          {% if user.profile %}
            <img src="{{ user.profile.get_avatar_url }}" alt="{{ user.username }}'s avatar" class="dashboard-avatar">
            <p class="avatar-source">{% if user.profile.avatar %}Custom Avatar{% else %}Gravatar{% endif %}</p>
          {% else %}
            <img src="https://www.gravatar.com/avatar/?s=200&d=identicon" alt="{{ user.username }}'s avatar" class="dashboard-avatar">
            <p class="avatar-source">Gravatar (default)</p>
          {% endif %}
        </div>
      </section>
      
      <section class="features">
        <div class="feature-card">
          <h3>Your Courses</h3>
          <p>View and manage all your enrolled courses in one place.</p>
        </div>
        <div class="feature-card">
          <h3>Learning Progress</h3>
          <p>Track your achievements and see how far you've come.</p>
        </div>
        <div class="feature-card">
          <h3>Daily Quest</h3>
          <p>Complete today's challenge to earn bonus XP and rewards!</p>
          <a href="{% url 'daily_quest' %}" style="display: inline-block; margin-top: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">Start Quest</a>
        </div>
        <div class="feature-card">
          <h3>Study Schedule</h3>
          <p>Stay on track with your personalized study plan.</p>
        </div>
      </section>
    </main>
    
    <footer>
      <p>&copy; 2025 Language Learning Platform. Start learning today!</p>
    </footer>

    <script>
      // Mobile menu toggle
      const navToggle = document.querySelector('.nav-toggle');
      const navMenu = document.querySelector('.nav-menu');
      
      navToggle.addEventListener('click', () => {
        navMenu.classList.toggle('active');
        navToggle.classList.toggle('active');
      });

      // Close menu when clicking outside
      document.addEventListener('click', (e) => {
        if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
          navMenu.classList.remove('active');
          navToggle.classList.remove('active');
        }
      });
    </script>
  </body>
</html>