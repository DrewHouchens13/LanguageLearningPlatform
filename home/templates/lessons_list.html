{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lessons - Language Learning Platform</title>
    {% if IS_DEVEDU %}<base href="/proxy/8000{{ request.path }}{% if not request.path|slice:'-1:' == '/' %}/{% endif %}">{% endif %}
    <link rel="stylesheet" href="{% static 'home/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/components.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/pages.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/animations.css' %}">
    <link rel="stylesheet" href="{% static 'home/css/utilities.css' %}">
</head>
<body>
    {% include '_nav.html' %}

    <main class="container" style="padding-top: var(--space-3xl);">
        {% if not user.is_authenticated %}
        <!-- Guest View - Login Required -->
        <div class="text-center fade-in" style="padding: var(--space-4xl) 0;">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ”’</div>
                <h2 class="text-5xl font-black mb-lg">Premium Lessons Await</h2>
                <p class="lead mb-xl">Our interactive language lessons are exclusively available to registered members.<br>Complete your placement test to unlock personalized learning content!</p>
                <div class="flex gap-lg justify-center flex-wrap">
                    <a href="{% url 'login' %}" class="btn btn-primary btn-lg">
                        Login to Access Lessons
                    </a>
                    <a href="{% url 'onboarding_welcome' %}" class="btn btn-accent btn-lg">
                        Take Placement Test
                    </a>
                </div>
            </div>
        </div>
        {% else %}
        <!-- Logged In User View -->
        <!-- Header -->
        <div class="lessons-header fade-in">
            <h2>Explore Lessons by Language</h2>
            <p>Choose a language to start learning</p>
        </div>

        {% if lessons_by_language %}
            <!-- Language Selection Buttons -->
            <div class="fade-in-up" style="margin-bottom: var(--space-2xl);">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-lg); max-width: 900px; margin: 0 auto;">
                    {% for language, language_lessons in lessons_by_language.items %}
                    <div class="card card-bordered" style="cursor: pointer; transition: all 0.3s ease;" onclick="scrollToLanguage('{{ language }}')">
                        <div class="card-body text-center">
                            <div style="font-size: 3rem; margin-bottom: var(--space-sm);">
                                {% if language == 'Spanish' %}ğŸ‡ªğŸ‡¸
                                {% elif language == 'French' %}ğŸ‡«ğŸ‡·
                                {% elif language == 'German' %}ğŸ‡©ğŸ‡ª
                                {% elif language == 'Italian' %}ğŸ‡®ğŸ‡¹
                                {% elif language == 'Japanese' %}ğŸ‡¯ğŸ‡µ
                                {% elif language == 'Chinese' %}ğŸ‡¨ğŸ‡³
                                {% else %}ğŸŒ{% endif %}
                            </div>
                            <h3 class="card-title mb-xs">{{ language }}</h3>
                            <p class="text-muted" style="font-size: var(--font-size-sm);">{{ language_lessons|length }} lesson{{ language_lessons|length|pluralize }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Lessons Grouped by Language -->
            {% for language, language_lessons in lessons_by_language.items %}
            <div id="language-{{ language }}" class="fade-in-up" style="margin-bottom: var(--space-3xl);">
                <div style="margin-bottom: var(--space-lg);">
                    <h2 style="font-size: var(--font-size-3xl); font-weight: 700; margin-bottom: var(--space-xs);">
                        {% if language == 'Spanish' %}ğŸ‡ªğŸ‡¸
                        {% elif language == 'French' %}ğŸ‡«ğŸ‡·
                        {% elif language == 'German' %}ğŸ‡©ğŸ‡ª
                        {% elif language == 'Italian' %}ğŸ‡®ğŸ‡¹
                        {% elif language == 'Japanese' %}ğŸ‡¯ğŸ‡µ
                        {% elif language == 'Chinese' %}ğŸ‡¨ğŸ‡³
                        {% else %}ğŸŒ{% endif %}
                        {{ language }} Lessons
                    </h2>
                    <p class="text-muted">{{ language_lessons|length }} lesson{{ language_lessons|length|pluralize }} available</p>
                </div>

                <div class="lessons-grid">
                    {% for lesson in language_lessons %}
                    <div class="lesson-card fade-in-up delay-{{ forloop.counter }}00">
                        <div class="lesson-card-header">
                            <div class="lesson-icon">ğŸ“š</div>
                        </div>
                        <div class="lesson-card-body">
                            <h3 class="lesson-card-title">{{ lesson.title }}</h3>
                            <p class="lesson-card-description">{{ lesson.description }}</p>

                            <div class="lesson-card-meta">
                                <span class="badge badge-primary">
                                    {{ lesson.get_difficulty_level_display }}
                                </span>
                                <span class="badge badge-success">
                                    +{{ lesson.xp_value }} XP
                                </span>
                            </div>
                        </div>
                        <div class="lesson-card-footer">
                            <a href="{% if IS_DEVEDU %}../lessons/{{ lesson.id }}/{% else %}{% url 'lesson_detail' lesson.id %}{% endif %}"
                               class="btn btn-primary btn-full">
                                Start Lesson â†’
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}

        {% else %}
            <!-- No Lessons Available -->
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“š</div>
                <h3>No Lessons Available Yet</h3>
                <p>Check back soon for new learning content!</p>
            </div>
        {% endif %}
        {% endif %}
    </main>

    <footer>
      <p>&copy; 2025 Language Learning Platform. Empowering language learners worldwide.</p>
    </footer>

    <script>
      // Smooth scroll to language section
      function scrollToLanguage(language) {
        const element = document.getElementById('language-' + language);
        if (element) {
          element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }

      // Mobile menu toggle
      const navToggle = document.querySelector('.nav-toggle');
      const navCenter = document.querySelector('.nav-center');

      if (navToggle && navCenter) {
        navToggle.addEventListener('click', () => {
          navCenter.classList.toggle('active');
          navToggle.classList.toggle('active');
        });

        document.addEventListener('click', (e) => {
          if (!navToggle.contains(e.target) && !navCenter.contains(e.target)) {
            navCenter.classList.remove('active');
            navToggle.classList.remove('active');
          }
        });
      }

      // Hover effect for language cards
      const languageCards = document.querySelectorAll('.card[onclick]');
      languageCards.forEach(card => {
        card.addEventListener('mouseenter', () => {
          card.style.transform = 'translateY(-4px)';
          card.style.boxShadow = '0 8px 16px rgba(0,0,0,0.1)';
        });
        card.addEventListener('mouseleave', () => {
          card.style.transform = 'translateY(0)';
          card.style.boxShadow = '';
        });
      });
    </script>
</body>
</html>
