# ğŸš€ Render.com Deployment Guide

Complete guide to deploy the Language Learning Platform to Render.com.

## Prerequisites

- âœ… GitHub account with this repository
- âœ… [Render.com](https://render.com) account (free tier)
- âœ… Code pushed to the `main` branch

---

## Quick Deploy (Recommended Method)

This uses the `render.yaml` file for automated deployment.

### Step 1: Push Your Code to GitHub

Make sure all changes are on your `main` branch:

```bash
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

### Step 2: Deploy on Render

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **"New +"** â†’ **"Blueprint"**
3. Click **"Connect GitHub"** and authorize Render
4. Select your repository: **LanguageLearningPlatform**
5. Render will detect `render.yaml`
6. Give your blueprint a name: **language-learning-platform**
7. Click **"Apply"**

### Step 3: Wait for Deployment

Render will automatically:
- Create a PostgreSQL database
- Build your Django application
- Run migrations
- Collect static files
- Deploy your application

**Time**: 5-10 minutes for first deployment

### Step 4: Access Your Application

Once deployment shows **"Live"**, your app will be available at:
```
https://language-learning-platform.onrender.com
```

---

## What Happens During Deployment

### 1. Database Creation
- PostgreSQL database is created
- Free tier: 256 MB storage
- Internal connection string is generated

### 2. Build Phase (`build.sh`)
```bash
pip install -r requirements.txt        # Install dependencies
python manage.py collectstatic         # Collect static files
python manage.py migrate               # Run database migrations
```

### 3. Start Phase
```bash
gunicorn config.wsgi:application       # Start production server
```

### 4. Environment Variables (Auto-configured)
- `SECRET_KEY` - Generated by Render
- `DEBUG` - Set to `False`
- `DATABASE_URL` - From PostgreSQL database
- `RENDER_EXTERNAL_HOSTNAME` - Your app's domain

---

## Manual Deployment (Alternative)

If you prefer manual setup instead of Blueprint:

### Step 1: Create PostgreSQL Database

1. In Render Dashboard, click **"New +"** â†’ **"PostgreSQL"**
2. Configure:
   - **Name**: `language-learning-db`
   - **Database**: `language_learning_db`
   - **User**: `language_learning_user`
   - **Region**: Choose closest to you
   - **PostgreSQL Version**: 16
   - **Plan**: Free
3. Click **"Create Database"**
4. **Copy the "Internal Database URL"** (you'll need it in Step 2)

### Step 2: Create Web Service

1. Click **"New +"** â†’ **"Web Service"**
2. Click **"Build and deploy from a Git repository"**
3. Connect to your GitHub repository
4. Configure:
   - **Name**: `language-learning-platform`
   - **Runtime**: **Python 3**
   - **Region**: Same as your database
   - **Branch**: `main`
   - **Build Command**: `./build.sh`
   - **Start Command**: `gunicorn config.wsgi:application`
   - **Plan**: **Free**

### Step 3: Add Environment Variables

In the **"Environment"** section, add:

| Key | Value |
|-----|-------|
| `PYTHON_VERSION` | `3.11.0` |
| `SECRET_KEY` | Click **"Generate"** button |
| `DEBUG` | `False` |
| `DATABASE_URL` | Paste the Internal Database URL from Step 1 |

### Step 4: Deploy

1. Click **"Create Web Service"**
2. Monitor the logs for build progress
3. Wait for status to show **"Live"**

---

## Post-Deployment

### Create Admin Superuser

To access the Django admin panel, you need to create a superuser.

**Note**: Render's free tier doesn't include Shell access. You have two options:

**Option A: Temporarily upgrade to Starter plan ($7/month)**
1. Upgrade your web service
2. Use Shell tab to run: `python manage.py createsuperuser`
3. Downgrade back to Free

**Option B: Create via management command**
1. Add this file locally: `home/management/commands/create_admin.py`
2. Run via startup script
3. (Contact if you need help with this)

### Access Your Application

- **Home**: `https://language-learning-platform.onrender.com/`
- **Admin**: `https://language-learning-platform.onrender.com/admin/`

**Note**: The `/progress/` route is not yet implemented and will show 404.

---

## Updating Your Deployed App

Render automatically deploys when you push to `main`:

```bash
# Make your changes locally
git add .
git commit -m "Update application"
git push origin main
```

Render detects the push and automatically rebuilds/redeploys (takes 3-5 minutes).

### Manual Deploy

Alternatively, in Render Dashboard:
1. Go to your Web Service
2. Click **"Manual Deploy"** â†’ **"Deploy latest commit"**

---

## Environment Configuration Explained

Your `config/settings.py` automatically detects the environment:

### Production (Render)
- `DATABASE_URL` is set â†’ Uses PostgreSQL
- `DEBUG = False` â†’ Production mode
- `STATIC_URL = '/static/'`
- WhiteNoise serves static files
- Security features enabled (HTTPS, secure cookies, etc.)

### Development (Local)
- No `DATABASE_URL` â†’ Uses SQLite
- `DEBUG = True` â†’ Development mode
- Django development server
- Guest data available via fixtures

---

## Troubleshooting

### Build Failed

**Check**: Build logs in Render Dashboard

**Common causes**:
- `requirements.txt` missing a package
- `build.sh` doesn't have execute permissions
- Syntax errors in code

**Fix**:
```bash
# Make build.sh executable
git update-index --chmod=+x build.sh
git commit -m "Make build.sh executable"
git push origin main
```

### 500 Internal Server Error

**Check**: Application logs in Render Dashboard

**Common causes**:
- `SECRET_KEY` not set
- `DATABASE_URL` incorrect
- Database migration failed

**Fix**: Verify environment variables are set correctly

### Static Files Not Loading

**Verify**:
- WhiteNoise is in `MIDDLEWARE` (already configured)
- `collectstatic` ran successfully (check build logs)
- `STATIC_ROOT` is set (already configured)

### Database Connection Errors

**Verify**:
- Database status is "Available"
- `DATABASE_URL` environment variable is set
- Database and web service in same region

**Fix**: Copy the correct Internal Database URL from your database's "Connect" tab

### Page Not Found (404)

**If you get 404 on `/progress/`**:
- This route is not yet implemented
- Only `/` (home) and `/admin/` are available
- Check `home/urls.py` for implemented routes

---

## Free Tier Limitations

**What to expect**:
- âœ… 750 hours/month (enough for 1 app)
- âœ… Free SSL certificate (HTTPS)
- âœ… Auto-deploy from GitHub
- âš ï¸ **Spins down after 15 min of inactivity**
- âš ï¸ First request after spin-down: 30-60 seconds delay
- âš ï¸ 512 MB RAM
- âš ï¸ PostgreSQL expires after 90 days (Render warns you)

**Upgrade to Starter ($7/month)**:
- No spin-down (always on)
- 2 GB RAM
- PostgreSQL doesn't expire
- Automatic backups
- Shell access

---

## File Structure Created for Deployment

```
LanguageLearningPlatform/
â”œâ”€â”€ build.sh              # Build script (install, migrate, collect static)
â”œâ”€â”€ render.yaml           # Infrastructure as Code (automated setup)
â”œâ”€â”€ requirements.txt      # Python dependencies (including production packages)
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py       # Updated with production settings
â””â”€â”€ DEPLOYMENT.md         # This file
```

### Key Changes to `config/settings.py`

1. **Environment-based configuration**:
   - Reads `SECRET_KEY`, `DEBUG`, `DATABASE_URL` from environment
   - Auto-detects Render via `RENDER_EXTERNAL_HOSTNAME`

2. **Database**: PostgreSQL in production, SQLite locally

3. **Static files**: WhiteNoise for production serving

4. **Security**: Production security settings enabled when `DEBUG=False`

---

## Monitoring Your App

### View Logs

1. Go to your Web Service in Render Dashboard
2. Click **"Logs"** tab
3. Real-time logs show requests and errors

### Metrics

Free tier provides:
- Bandwidth usage
- Request count
- Response times
- Memory usage

---

## Backup Your Database

**Important**: Free tier has no automatic backups.

### Manual Backup Option

If you upgrade to Starter plan temporarily:
```bash
# In Render Shell
python manage.py dumpdata > backup.json
```

Or export from database directly using `pg_dump`.

---

## Cost Summary

**Current Setup (Free)**:
- Web Service: $0/month
- PostgreSQL: $0/month (expires after 90 days)
- SSL: Included
- **Total: $0/month**

**Recommended (Starter)**:
- Web Service: $7/month
- PostgreSQL: $7/month (optional, can keep free)
- **Total: $7-14/month**

---

## Security Checklist

Your deployment includes these security features:

- âœ… HTTPS enforced (HSTS enabled)
- âœ… Secure session cookies
- âœ… CSRF protection
- âœ… XSS protection
- âœ… Clickjacking protection
- âœ… Secret key from environment
- âœ… Debug mode off in production
- âœ… Database connection pooling

---

## Quick Reference Commands

### Django Management Commands

```bash
# View migrations status
python manage.py showmigrations

# Create new migrations
python manage.py makemigrations

# Run migrations
python manage.py migrate

# Collect static files
python manage.py collectstatic --no-input

# Create superuser (requires Shell access)
python manage.py createsuperuser
```

### Git Commands

```bash
# Check current branch
git branch

# Push to main
git push origin main

# View recent commits
git log --oneline -5
```

---

## Support Resources

- ğŸ“š [Render Documentation](https://render.com/docs)
- ğŸ [Django Deployment Checklist](https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/)
- ğŸ’¬ [Render Community](https://community.render.com/)

---

## Ready to Deploy?

1. âœ… Ensure code is on `main` branch
2. âœ… Push to GitHub
3. âœ… Go to [Render Dashboard](https://dashboard.render.com/)
4. âœ… New + â†’ Blueprint â†’ Select repo
5. âœ… Wait 5-10 minutes
6. âœ… Access your live app!

---

**Questions or issues?** Check the Troubleshooting section above or Render's documentation.
